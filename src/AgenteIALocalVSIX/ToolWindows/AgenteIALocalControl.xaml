<UserControl x:Class="AgenteIALocalVSIX.ToolWindows.AgenteIALocalControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes">

  <UserControl.Resources>
    <SolidColorBrush x:Key="HeaderBackgroundBrush" Color="#FF1E1E22" />
    <SolidColorBrush x:Key="HeaderHighEmphasisBrush" Color="#FFFFFFFF" />
    <SolidColorBrush x:Key="HeaderMediumEmphasisBrush" Color="#CCFFFFFF" />
  </UserControl.Resources>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!-- HEADER SECTION -->
    <Grid x:Name="HeaderContainer" Grid.Row="0" MinHeight="88">
      <Border Margin="16,8,16,0"
              Padding="20,12"
              Background="{StaticResource HeaderBackgroundBrush}"
              BorderBrush="{StaticResource HeaderMediumEmphasisBrush}"
              BorderThickness="0,0,0,1">
        <Grid VerticalAlignment="Center">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
          </Grid.ColumnDefinitions>

          <!-- Title block -->
          <TextBlock Grid.Column="0"
                     Text="Agente IA Local"
                     FontSize="22"
                     FontWeight="Bold"
                     VerticalAlignment="Center"
                     Foreground="{StaticResource HeaderHighEmphasisBrush}"
                     Style="{StaticResource MaterialDesignHeadline6TextBlock}" />

          <!-- Counters + State block -->
          <Grid Grid.Column="1" Margin="32,0,32,0" VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,12,0">
              <TextBlock Text="Solutions: "
                         FontSize="13"
                         Foreground="{StaticResource HeaderMediumEmphasisBrush}"
                         Style="{StaticResource MaterialDesignBody2TextBlock}" />
              <TextBlock x:Name="SolutionNameText"
                         Text="0"
                         FontSize="13"
                         FontWeight="SemiBold"
                         Foreground="{StaticResource HeaderMediumEmphasisBrush}"
                         Style="{StaticResource MaterialDesignBody2TextBlock}" />
              <TextBlock Text="  " />
              <TextBlock Text="Projects: "
                         FontSize="13"
                         Foreground="{StaticResource HeaderMediumEmphasisBrush}"
                         Style="{StaticResource MaterialDesignBody2TextBlock}" />
              <TextBlock x:Name="ProjectCountText"
                         Text="0"
                         FontSize="13"
                         FontWeight="SemiBold"
                         Foreground="{StaticResource HeaderMediumEmphasisBrush}"
                         Style="{StaticResource MaterialDesignBody2TextBlock}" />
            </StackPanel>

            <StackPanel Grid.Column="2"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Margin="12,0,0,0">
              <md:PackIcon x:Name="StateIcon"
                           Kind="{Binding StateIconKind}"
                           Width="20"
                           Height="20"
                           Foreground="{Binding StateColor}" />
              <TextBlock x:Name="StateLabelText"
                         Text="{Binding StateLabel}"
                         Margin="6,0,0,0"
                         FontSize="13"
                         FontWeight="SemiBold"
                         Foreground="{Binding StateColor}"
                         Style="{StaticResource MaterialDesignBody2TextBlock}" />
            </StackPanel>
          </Grid>

          <!-- Actions block -->
          <StackPanel Grid.Column="2"
                      Orientation="Horizontal"
                      VerticalAlignment="Center">
            <Button x:Name="SettingsButton"
                    Width="36"
                    Height="36"
                    Click="SettingsButton_Click"
                    Style="{StaticResource MaterialDesignToolButton}">
              <md:PackIcon Kind="Cog"
                           Width="20"
                           Height="20"
                           Foreground="{StaticResource HeaderHighEmphasisBrush}" />
            </Button>
            <Button Width="36"
                    Height="36"
                    Margin="8,0,0,0"
                    Style="{StaticResource MaterialDesignToolButton}">
              <md:PackIcon Kind="HelpCircleOutline"
                           Width="20"
                           Height="20"
                           Foreground="{StaticResource HeaderHighEmphasisBrush}" />
            </Button>
          </StackPanel>
        </Grid>
      </Border>
    </Grid>

    <!-- BODY SECTION -->
    <Grid x:Name="BodyContainer" Grid.Row="1">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
        <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

      <!-- CHAT TOOLBAR (Items 7–9) -->
      <Grid x:Name="ChatToolbarGrid" Grid.Row="0" Margin="16,0,16,8">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
          <ComboBox x:Name="ChatComboBox"
                    Width="260"
                    Height="32"
                    Padding="12,4,12,4"
                    SelectionChanged="ChatComboBox_SelectionChanged"
                    Style="{StaticResource MaterialDesignOutlinedComboBox}" />
          <Button x:Name="NewChatButton"
                  Width="36"
                  Height="36"
                  Margin="8,0,0,0"
                  Click="NewChatButton_Click"
                  Style="{StaticResource MaterialDesignToolButton}">
            <md:PackIcon Kind="Plus"
                         Width="20"
                         Height="20" />
          </Button>
        </StackPanel>

        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
          <Button x:Name="DeleteChatButton"
                  Width="36"
                  Height="36"
                  Click="DeleteChatButton_Click"
                  Style="{StaticResource MaterialDesignToolButton}">
            <md:PackIcon Kind="TrashCanOutline"
                         Width="20"
                         Height="20" />
          </Button>
          <Button x:Name="RunButton" Content="Run" Margin="8,0,0,0" Click="RunButton_Click" IsEnabled="{Binding RunButtonEnabled}" />
          <Button x:Name="ClearButton" Content="Clear" Margin="8,0,0,0" Click="ClearButton_Click" IsEnabled="{Binding ClearButtonEnabled}" />
        </StackPanel>
      </Grid>

      <!-- CHANGES ACCORDION (Items 10–13) -->
      <Expander Grid.Row="1"
                Margin="16,0,16,8"
                Background="{DynamicResource MaterialDesignPaper}"
                BorderBrush="{DynamicResource MaterialDesignDivider}"
                BorderThickness="1">
        <Expander.Header>
          <Grid x:Name="ChangesAccordionHeaderGrid" Margin="12,4" VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*" />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="Changes (N)"
                       FontWeight="SemiBold"
                       VerticalAlignment="Center"
                       Style="{StaticResource MaterialDesignBody1TextBlock}" />
            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        VerticalAlignment="Center">
              <Button Width="32" Height="32" Style="{StaticResource MaterialDesignToolButton}">
                <md:PackIcon Kind="ContentSave" Width="20" Height="20" />
              </Button>
              <Button Width="32" Height="32" Margin="4,0,0,0" Style="{StaticResource MaterialDesignToolButton}">
                <md:PackIcon Kind="DeleteSweepOutline" Width="20" Height="20" />
              </Button>
              <Button Width="32" Height="32" Margin="4,0,0,0" Style="{StaticResource MaterialDesignToolButton}">
                <md:PackIcon Kind="EraserVariant" Width="20" Height="20" />
              </Button>
            </StackPanel>
          </Grid>
        </Expander.Header>

        <ItemsControl Margin="12,8" ItemTemplate="{DynamicResource MaterialDesignTextBlockListItem}">
          <ItemsControl.Items>
            <TextBlock Text="src/App.xaml" Style="{StaticResource MaterialDesignBody2TextBlock}" />
            <TextBlock Text="src/Services/Runner.cs" Style="{StaticResource MaterialDesignBody2TextBlock}" />
            <TextBlock Text="tests/RunnerTests.cs" Style="{StaticResource MaterialDesignBody2TextBlock}" />
          </ItemsControl.Items>
        </ItemsControl>
      </Expander>

      <!-- MAIN CONTENT (Request / Response / Log) -->
      <TabControl Grid.Row="2"
                  Margin="16"
                  Style="{StaticResource MaterialDesignTabControl}"
                  md:ColorZoneAssist.Mode="PrimaryDark">
        <TabItem Header="Request">
          <Grid x:Name="RequestTabContentGrid" Margin="12">
            <TextBox x:Name="RequestJsonText"
                     AcceptsReturn="True"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     TextWrapping="Wrap"
                     VerticalScrollBarVisibility="Auto"
                     Padding="12"
                     MinHeight="180" />
          </Grid>
        </TabItem>
        <TabItem Header="Response">
          <Grid x:Name="ResponseTabContentGrid" Margin="12">
            <TextBox x:Name="ResponseJsonText"
                     AcceptsReturn="True"
                     IsReadOnly="True"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     TextWrapping="Wrap"
                     VerticalScrollBarVisibility="Auto"
                     Padding="12"
                     MinHeight="180" />
          </Grid>
        </TabItem>
        <TabItem Header="Log">
          <Grid x:Name="LogTabContentGrid" Margin="12">
            <TextBox x:Name="LogText"
                     AcceptsReturn="True"
                     IsReadOnly="True"
                     Style="{StaticResource MaterialDesignOutlinedTextBox}"
                     TextWrapping="Wrap"
                     VerticalScrollBarVisibility="Auto"
                     Padding="12"
                     MinHeight="180" />
          </Grid>
        </TabItem>
      </TabControl>

      <!-- PROMPT AREA (Items 14–19) -->
      <Grid x:Name="PromptAreaGrid" Grid.Row="3" Margin="16">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>

        <TextBox x:Name="PromptTextBox" Height="60" AcceptsReturn="True" />

        <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
          <ComboBox Width="120" />
          <ComboBox Width="160" Margin="8,0,0,0" />
          <ComboBox Width="120" Margin="8,0,0,0" />
          <Button Content="Send" Margin="8,0,0,0" />
        </StackPanel>
      </Grid>
    </Grid>

    <!-- FOOTER SECTION -->
    <Grid x:Name="FooterContainer" Grid.Row="2" />

    <!-- SETTINGS PANEL (hidden overlay) -->
    <Border x:Name="SettingsPanel"
            Grid.RowSpan="3"
            HorizontalAlignment="Right"
            Margin="16"
            Padding="12"
            Width="300"
            Background="{DynamicResource {x:Static SystemColors.ControlLightBrushKey}}"
            BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
            BorderThickness="1"
            Visibility="Collapsed"
            Panel.ZIndex="1">
      <StackPanel>
        <TextBlock Text="Settings (active server)" FontWeight="Bold" Margin="0,0,0,8" />

        <TextBlock Text="Active Server ID:" />
        <TextBox x:Name="ActiveServerIdTextBox" Margin="0,4,0,8" />

        <TextBlock Text="Base URL:" />
        <TextBox x:Name="ServerBaseUrlTextBox" Margin="0,4,0,8" />

        <TextBlock Text="Model:" />
        <TextBox x:Name="ServerModelTextBox" Margin="0,4,0,8" />

        <TextBlock Text="API Key:" />
        <TextBox x:Name="ServerApiKeyTextBox" Margin="0,4,0,8" />

        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
          <Button x:Name="SaveSettingsButton" Content="Save" Width="80" Click="SaveSettingsButton_Click" />
          <Button x:Name="CloseSettingsButton" Content="Close" Width="80" Margin="8,0,0,0" Click="CloseSettingsButton_Click" />
        </StackPanel>
      </StackPanel>
    </Border>

  </Grid>
</UserControl>
