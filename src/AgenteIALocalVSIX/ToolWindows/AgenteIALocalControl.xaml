<UserControl x:Class="AgenteIALocalVSIX.ToolWindows.AgenteIALocalControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes">

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <!-- HEADER (Items 1–6) -->
    <Grid Grid.Row="0" Margin="16,12,16,12">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <!-- Title block -->
      <TextBlock Grid.Column="0"
                 Text="Agente IA Local"
                 FontSize="21"
                 FontWeight="SemiBold"
                 VerticalAlignment="Center"
                 Style="{StaticResource MaterialDesignHeadline6TextBlock}" />

      <!-- Counters + State block -->
      <Grid Grid.Column="1" Margin="24,0,24,0">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
          <TextBlock Text="Solutions: " Style="{StaticResource MaterialDesignBody2TextBlock}" />
          <TextBlock x:Name="SolutionNameText" Text="0" Style="{StaticResource MaterialDesignBody2TextBlock}" />
          <TextBlock Text="  " />
          <TextBlock Text="Projects: " Style="{StaticResource MaterialDesignBody2TextBlock}" />
          <TextBlock x:Name="ProjectCountText" Text="0" Style="{StaticResource MaterialDesignBody2TextBlock}" />
        </StackPanel>

        <StackPanel Grid.Column="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center">
          <md:PackIcon x:Name="StateIcon"
                       Kind="{Binding StateIconKind}"
                       Width="20"
                       Height="20"
                       Foreground="{Binding StateColor}" />
          <TextBlock x:Name="StateLabelText"
                     Text="{Binding StateLabel}"
                     Margin="6,0,0,0"
                     Style="{StaticResource MaterialDesignBody2TextBlock}" />
        </StackPanel>
      </Grid>

      <!-- Actions block -->
      <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
        <Button x:Name="SettingsButton"
                Click="SettingsButton_Click"
                Style="{StaticResource MaterialDesignToolButton}">
          <md:PackIcon Kind="Cog"
                       Width="20"
                       Height="20" />
        </Button>
        <Button Margin="8,0,0,0"
                Style="{StaticResource MaterialDesignToolButton}">
          <md:PackIcon Kind="HelpCircleOutline"
                       Width="20"
                       Height="20" />
        </Button>
      </StackPanel>
    </Grid>

    <!-- CHAT TOOLBAR (Items 7–9) -->
    <Grid Grid.Row="1" Margin="16,0,16,8">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
        <ComboBox x:Name="ChatComboBox" Width="220" SelectionChanged="ChatComboBox_SelectionChanged" />
        <Button x:Name="NewChatButton" Content="+" Margin="8,0,0,0" Click="NewChatButton_Click" />
        <Button x:Name="DeleteChatButton" Content="-" Margin="8,0,0,0" Click="DeleteChatButton_Click" />
      </StackPanel>

      <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
        <Button x:Name="RunButton" Content="Run" Click="RunButton_Click" IsEnabled="{Binding RunButtonEnabled}" />
        <Button x:Name="ClearButton" Content="Clear" Margin="8,0,0,0" Click="ClearButton_Click" IsEnabled="{Binding ClearButtonEnabled}" />
      </StackPanel>
    </Grid>

    <!-- CHANGES ACCORDION (Items 10–13) -->
    <Expander Grid.Row="2" Header="Changes (0)" Margin="16,0,16,8" />

    <!-- MAIN CONTENT (Request / Response / Log) -->
    <TabControl Grid.Row="2" Margin="16">
      <TabItem Header="Request">
        <TextBox x:Name="RequestJsonText" AcceptsReturn="True" />
      </TabItem>
      <TabItem Header="Response">
        <TextBox x:Name="ResponseJsonText" AcceptsReturn="True" IsReadOnly="True" />
      </TabItem>
      <TabItem Header="Log">
        <TextBox x:Name="LogText" AcceptsReturn="True" IsReadOnly="True" />
      </TabItem>
    </TabControl>

    <!-- PROMPT AREA (Items 14–19) -->
    <Grid Grid.Row="3" Margin="16">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*" />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>

      <TextBox x:Name="PromptTextBox" Height="60" AcceptsReturn="True" />

      <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
        <ComboBox Width="120" />
        <ComboBox Width="160" Margin="8,0,0,0" />
        <ComboBox Width="120" Margin="8,0,0,0" />
        <Button Content="Send" Margin="8,0,0,0" />
      </StackPanel>
    </Grid>

    <!-- SETTINGS PANEL (hidden overlay) -->
    <Border x:Name="SettingsPanel"
            Grid.RowSpan="4"
            HorizontalAlignment="Right"
            Margin="16"
            Padding="12"
            Width="300"
            Background="{DynamicResource {x:Static SystemColors.ControlLightBrushKey}}"
            BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}"
            BorderThickness="1"
            Visibility="Collapsed"
            Panel.ZIndex="1">
      <StackPanel>
        <TextBlock Text="Settings (active server)" FontWeight="Bold" Margin="0,0,0,8" />

        <TextBlock Text="Active Server ID:" />
        <TextBox x:Name="ActiveServerIdTextBox" Margin="0,4,0,8" />

        <TextBlock Text="Base URL:" />
        <TextBox x:Name="ServerBaseUrlTextBox" Margin="0,4,0,8" />

        <TextBlock Text="Model:" />
        <TextBox x:Name="ServerModelTextBox" Margin="0,4,0,8" />

        <TextBlock Text="API Key:" />
        <TextBox x:Name="ServerApiKeyTextBox" Margin="0,4,0,8" />

        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
          <Button x:Name="SaveSettingsButton" Content="Save" Width="80" Click="SaveSettingsButton_Click" />
          <Button x:Name="CloseSettingsButton" Content="Close" Width="80" Margin="8,0,0,0" Click="CloseSettingsButton_Click" />
        </StackPanel>
      </StackPanel>
    </Border>

  </Grid>
</UserControl>
